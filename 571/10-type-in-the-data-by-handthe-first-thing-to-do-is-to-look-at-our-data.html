<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Statistical Methods II</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="The second semester of an Intro Stats course designed for graduate students in Biology, Forestry, Ecology, etc.">
  <meta name="generator" content="bookdown 0.1.5 and GitBook 2.6.7">

  <meta property="og:title" content="Statistical Methods II" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The second semester of an Intro Stats course designed for graduate students in Biology, Forestry, Ecology, etc." />
  <meta name="github-repo" content="dereksonderegger/STA_571_Book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Statistical Methods II" />
  
  <meta name="twitter:description" content="The second semester of an Intro Stats course designed for graduate students in Biology, Forestry, Ecology, etc." />
  

<meta name="author" content="Derek L. Sonderegger">

<meta name="date" content="2016-09-22">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="9-two-way-anova.html">


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Methods II</a></li>
<li><a href="https://dereksonderegger.github.io/571/Statistical_Methods_II.pdf" target="blank">PDF version</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Matrix Theory</a></li>
<li class="chapter" data-level="2" data-path="2-parameter-estimation.html"><a href="2-parameter-estimation.html"><i class="fa fa-check"></i><b>2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="3" data-path="3-inference.html"><a href="3-inference.html"><i class="fa fa-check"></i><b>3</b> Inference</a></li>
<li class="chapter" data-level="4" data-path="4-analysis-of-covariance-ancova.html"><a href="4-analysis-of-covariance-ancova.html"><i class="fa fa-check"></i><b>4</b> Analysis of Covariance (ANCOVA)</a></li>
<li class="chapter" data-level="5" data-path="5-contrasts.html"><a href="5-contrasts.html"><i class="fa fa-check"></i><b>5</b> Contrasts</a></li>
<li class="chapter" data-level="6" data-path="6-diagnostics-and-transformations.html"><a href="6-diagnostics-and-transformations.html"><i class="fa fa-check"></i><b>6</b> Diagnostics and Transformations</a></li>
<li class="chapter" data-level="7" data-path="7-variable-selection.html"><a href="7-variable-selection.html"><i class="fa fa-check"></i><b>7</b> Variable Selection</a></li>
<li class="chapter" data-level="8" data-path="8-one-way-anova.html"><a href="8-one-way-anova.html"><i class="fa fa-check"></i><b>8</b> One way ANOVA</a></li>
<li class="chapter" data-level="9" data-path="9-two-way-anova.html"><a href="9-two-way-anova.html"><i class="fa fa-check"></i><b>9</b> Two-way ANOVA</a><ul>
<li class="chapter" data-level="9.1" data-path="9-two-way-anova.html"><a href="9-two-way-anova.html#orthogonality"><i class="fa fa-check"></i><b>9.1</b> Orthogonality</a></li>
<li class="chapter" data-level="9.2" data-path="9-two-way-anova.html"><a href="9-two-way-anova.html#main-effects-model"><i class="fa fa-check"></i><b>9.2</b> Main Effects Model</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-type-in-the-data-by-handthe-first-thing-to-do-is-to-look-at-our-data.html"><a href="10-type-in-the-data-by-handthe-first-thing-to-do-is-to-look-at-our-data.html"><i class="fa fa-check"></i><b>10</b> type in the data by handThe first thing to do is to look at our data</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Methods II</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="type-in-the-data-by-handthe-first-thing-to-do-is-to-look-at-our-data" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> type in the data by handThe first thing to do is to look at our data</h1>
<p>fig.height=4, fig.width=6ggplot(fruit, aes(x=Pest, color=Var, y=Yield, shape=Var)) +</p>
<p>The first thing we notice is that pesticides B and D seem to be better than the others and that variety 3 seems to be the best producer. The effect of pesticide treatment seems consistent between varieties, so we don’t expect that the interaction effect will be significant. We next fit a linear model and look at the diagnostic plots.</p>
<p>fig.height=3, fig.width=6m3 &lt;- lm(Yield ~ Var + Pest, data=fruit)</p>
<p>There might be a little curvature in the fitted vs residuals, but since we can’t fit a polynomial to a categorical variable, and the QQ-plot looks good, we’ll ignore it for now and eventually consider an interaction term. Just for fun, we can examine the smaller models with just Variety or Pesticide.</p>
<p>m1 &lt;- lm(Yield ~ Var, data=fruit)</p>
<p>Notice that the affects for Variety and Pesticide are the same whether or not the other is in the model. This is due to the orthogonal design of the experiment and makes it much easier to interpret the main effects of Variety and Pesticide.</p>
<p>1.2.2 ANOVA Table</p>
<p>Most statistical software will produce an analysis of variance table when fitting a two-way ANOVA. This table is very similar to the analysis of variance table we have seen in the one-way ANOVA, but has several rows which correspond to the additional factors added to the model.</p>
<p>Consider the two-way ANOVA with factors A and B which have levels I and J discrete levels respectively. For convenience let RSS_{1} is the residual sum of squares of the intercept-only model, and RSS_{A} be the residual sum of squares for the model with just the main effect of factor A , and RSS_{A+B} be the residual sum of squares of the model with both main effects. Finally assume that we have a total of n observations. The ANOVA table for this model is as follows:</p>
<p>This arrangement of the ANOVA table is referred to as “Type I” sum of squares.</p>
<p>We can examine this table in the fruit trees example using the anova() command but just passing a single model.</p>
<p>m4 &lt;- lm(Yield ~ Var + Pest, data=fruit)</p>
<p>We might think that this is the same as fitting three nested models and running an F-test on each successive pairs of models, but it isn’t. While both will give the same Sums of Squares, the F statistics are different because the MSE of the complex model is different. In particular, the F-statistics are larger and thus the p-values are smaller for detecting significant effects.</p>
<p>m1 &lt;- lm(Yield ~ 1, data=fruit)</p>
<p>1.2.3 Estimating Contrasts</p>
<p>As in the one-way ANOVA, we are interested in which factor levels differ. For example, we might suspect that it makes sense to group pesticides B and D together and claim that they are better than the group of A and C.</p>
<p>Just as we did in the one-way ANOVA model, this is such a common thing to do that there is an easy way to do this, using TukeyHSD, which requires us to use the aov() function instead of lm().We could specify all of the contrasts by hand and use glht() in the multcomp package to calculate all of the contrasts. See the chapter on contrasts to see examples of how to do this.</p>
<p>TukeyHSD(aov(Yield ~ Var + Pest, data=fruit))</p>
<p>1.3 Interaction Model</p>
<p>When the model contains the interaction of the two factors, our model is written asy_{ijk}=+<em>{i}+</em>{j}+()<em>{ij}+</em>{ijk}</p>
<p>Interpreting effects effects can be very tricky. Under the interaction, the effect of changing from factor 1 level 1 to factor 1 level i depends on what level of factor 2 is. In essence, we are fitting a model that allows each of the IJ cells in my model to vary independently. As such, the model has a total of IJ parameters but because the model without interactions had 1+(I-1)+(J-1) terms in it, the interaction is adding df_{AB} parameters. We can solve for this via: IJ = 1+(I-1)+(J-1)+df_{AB} IJ = I+J-1+df_{AB} IJ-I-J = -1+df_{AB} I(J-1)-J = -1+df_{AB} I(J-1)-J+1 = df_{AB} I(J-1)-(J-1) = df_{AB} (I-1)(J-1) = df_{AB}</p>
<p>This makes sense because the first factor added (I-1) columns to the design matrix and an interaction with a continuous covariate just multiplied the columns of the factor by the single column of the continuous covariate. Creating an interaction of two factors multiplies each column of the first factor by all the columns defined by the second factor.</p>
<p>The expected value of the ij combination is +<em>{i}+</em>{j}+()_{ij} . Returning to our fungus example, the expected means for each treatment under the model with main effects and the interaction is</p>
<p>Notice that we have added 6=32=(4-1)(3-1)=(I-1)(J-1) interaction parameters ()_{ij} to the main effects only model. The interaction model has 12 parameters, one for each cell in my treatment array.</p>
<p>In general it is hard to interpret the meaning of <em>{i} , </em>{j} , and ()_{ij} and the best way to make sense of them is to look at the interaction plots.</p>
<p>1.3.1 ANOVA Table</p>
<p>Most statistical software will produce an analysis of variance table when fitting a two-way ANOVA. This table is very similar to the analysis of variance table we have seen in the one-way ANOVA, but has several rows which correspond to the additional factors added to the model.</p>
<p>Consider the two-way ANOVA with factors A and B which have levels I and J discrete levels respectively. For convenience let RSS_{1} is the residual sum of squares of the intercept-only model, and RSS_{A} be the residual sum of squares for the model with just the main effect of factor A . Likewise RSS_{A+B} and RSS_{A*B} shall be the residual sum of squares of the model with just the main effects and the model with main effects and the interaction. Finally assume that we have a total of n observations. The ANOVA table for this model is as follows:</p>
<p>This arrangement of the ANOVA table is referred to as “Type I” sum of squares.Type III sums of squares are the difference between the full interaction model and the model removing each parameter group, even when it doesn’t make sense. For example in the Type III table, SS_{A}=RSS_{B+A:B}-RSS_{A*B} . There is an intermediate form of the sums of squares called Type II, that when removing a main effect also removes the higher order interaction. In the case of balanced (orthogonal) designs, there is no difference between the different types, but for non-balanced designs, the numbers will change. To access these other types of sums of squares, use the Anova() function in the package car.</p>
<p>1.3.2 Example - Fruit Trees (continued)</p>
<p>We next consider whether or not to include the interaction term to the fruit tree model. We fit the model with the interaction and then graph the results.</p>
<p>fig.height=3, fig.width=5m4 &lt;- lm(Yield ~ Var * Pest, data=fruit)</p>
<p>All of the line segments are close to parallel so, we don’t expect the interaction to be significant.</p>
<p>anova( m4 )</p>
<p>Examining the ANOVA table, we see that the interaction effect is not significant and we will stay with simpler model Yield~Var+Pest.</p>
<p>1.3.3 Example - Warpbreaks</p>
<p>This data set looks at the number of breaks that occur in two different types of wool under three different levels of tension (low, medium, and high). The fewer number of breaks, the better.</p>
<p>As always, the first thing we do is look at the data. In this case, it looks like the number of breaks decreases with increasing tension and perhaps wool B has fewer breaks than wool A.</p>
<p>fig.height=2.5library(ggplot2)</p>
<p>We next fit our linear model and examine the diagnostic plots.</p>
<p>model &lt;- lm(breaks ~ tension + wool, data=warpbreaks)par(mfrow=c(1,2)) # side-by-side plotsplot(model, which=c(1,2))</p>
<p>The residuals vs fitted values plot is a little worrisome and appears to be an issue with non-constant variance, but the normality assumption looks good. We’ll check for a Box-Cox transformation next.</p>
<p>fig.height=2.5library(MASS)</p>
<p>This suggests we should make a log transformation, though because the confidence interval is quite wide we might consider if the increased difficulty in interpretation makes sufficient progress towards making the data meet the model assumptions.. The diagnostic plots of the resulting model look better for the constant variance assumption, but the normality is now a worse off. Because the Central Limit Theorem helps deal with the normality question, I’d rather stabilize the variance at the cost of the normality.</p>
<p>model.1 &lt;- lm(log(breaks) ~ tension + wool, data=warpbreaks)</p>
<p>Next we’ll fit the interaction model and check the diagnostic plots. The diagnostic plots look good and this appears to be a legitimate model.</p>
<p>model.2 &lt;- lm(log(breaks) ~ tension * wool, data=warpbreaks)</p>
<p>Then we’ll do an F-test to see if it is a better model than the main effects model. The p-value is marginally significant, so we’ll keep the interaction in the model, but recognize that it is a weak interaction.</p>
<p>anova(model.1, model.2)</p>
<p>Next we look at the effect of the interaction and the easiest way to do this is to look at the interaction plot. This plot shows the raw data and connects lines to the cell mean of each factor combination.</p>
<p>warpbreaks$logy.hat &lt;- predict(model.2)</p>
<p>We can see that it appears that wool A has a decrease in breaks between low and medium tension, while wool B has a decrease in breaks between medium and high. It is actually quite difficult to see this interaction when we examine the model coefficients.</p>
<p>summary(model.2)</p>
<p>To test if there is a statistically significant difference between medium and high tensions for wool type B, we really need to test the following hypothesisH_{0}:;(+<em>{2}+</em>{2}+()<em>{22})-(+</em>{3}+<em>{2}+()</em>{32}) = 0 H_{a}:;(+<em>{2}+</em>{2}+()<em>{22})-(+</em>{3}+<em>{2}+()</em>{32}) 0 This test reduces to testing if <em>{2}-</em>{3}+()<em>{22}-()</em>{23}=0 . Calculating this difference from the estimated values of the summery table we have -.6012+.6003+.6281-.2221=0.4051 . But we don’t know if that is significantly different than zero.</p>
<p>In the main effects model, we were able to read off the necessary test using Tukey’s HSD. Fortunately, we can do the same thing here. In this case, we’ll look at the interactions piece of the TukeyHSD command. In this case, we find the test H:B - M:B in the last row of the interactions.</p>
<p>model.2 &lt;- aov(log(breaks) ~ tension * wool, data=warpbreaks)</p>
<p>So TukeyHSD gives us all the tests comparing the cell means, but what are those main effects testing? In the case where our experiment is balanced with equal numbers of observations in each treatment cell, we can interpret these differences as follows. Knowing that each cell in our table has a different estimated mean, we could consider the average of all the type A cells as the typical wool A. Likewise we could average all the cell means for the wool B cells. Then we could look at the difference between those two averages. In the balanced design, this is equivalent to removing the tension term from the model and just looking at the difference between the average log number of breaks.</p>
<p>Using TukeyHSD, we can see the wool effect difference between types B and A is -0.1522 . We can calculate the mean number of log breaks for each wool type and take the difference by the following:</p>
<p>library(dplyr)</p>
<p>In the unbalanced case taking the average of the cell means produces a different answer than taking the average of the data. It isn’t clear which is preferred and TukeyHSD produces a result that is between those two methods.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="9-two-way-anova.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>


<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dereksonderegger/STA_571_Book/raw/master/09_TwoWayAnova.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
